DROP TABLE operations
IF EXISTS;
DROP TABLE accounts
IF EXISTS;
DROP TABLE users
IF EXISTS;

DROP SEQUENCE GLOBAL_SEQ
IF EXISTS;

CREATE SEQUENCE GLOBAL_SEQ
  AS INTEGER
    START WITH 100000;

CREATE TABLE users
(
  id       INTEGER GENERATED BY DEFAULT AS SEQUENCE GLOBAL_SEQ PRIMARY KEY,
  email    VARCHAR(255) NOT NULL,
  name     VARCHAR(255) NOT NULL,
  password VARCHAR(255) NOT NULL,
  role     VARCHAR(10)  NOT NULL,
  enabled  BOOLEAN DEFAULT TRUE
);
CREATE UNIQUE INDEX users_unique_email_idx ON users (email);

CREATE TABLE accounts
(
  id        INTEGER GENERATED BY DEFAULT AS SEQUENCE GLOBAL_SEQ PRIMARY KEY,
  user_id   INTEGER      NOT NULL,
  number    VARCHAR(255) NOT NULL,
  pin       VARCHAR(255) NOT NULL,
  balance   INTEGER DEFAULT 0,
  attempt   INTEGER DEFAULT 0,
  date_time TIMESTAMP,
  FOREIGN KEY ( user_id ) REFERENCES USERS (id)
    ON DELETE CASCADE
);

CREATE TABLE operations
(
  id         INTEGER GENERATED BY DEFAULT AS SEQUENCE GLOBAL_SEQ PRIMARY KEY,
  date_time  TIMESTAMP,
  amount     NUMERIC      NOT NULL,
  account_id INTEGER      NOT NULL,
  opt_type   VARCHAR(255) NOT NULL,
  FOREIGN KEY ( account_id ) REFERENCES ACCOUNTS (id)
    ON DELETE CASCADE
);







